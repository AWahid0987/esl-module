<odoo>
  <template id="result_template" name="GDfH Scoring Result">
    <t t-call="website.layout">
      <div class="container mt-5">
        <t t-if="results">
          <h2 class="mb-4">Thank you, <t t-esc="results[0].name"/>!</h2>
          <p><strong>Email:</strong> <t t-esc="results[0].email"/></p>
          <p><strong>Country:</strong> <t t-esc="results[0].country"/></p>

          <!-- ‚úÖ PAGE 1: Graph + Legend -->
          <div class="row mt-4">
            <div class="col-md-8">
              <h3 class="mb-3">Score Graph</h3>
              <canvas id="gdfhChart"></canvas>
            </div>
            <div class="col-md-3">
              <h3 class="mb-3">Legend</h3>
              <p><span style="color: green; font-weight: bold;">85-100 üåü Progressive Visionary</span></p>
              <p><span style="color: #28a745; font-weight: bold;">70-84 ‚úÖ Strong Contributor</span></p>
              <p><span style="color: orange; font-weight: bold;">50-69 ‚ö†Ô∏è Emerging Contributor</span></p>
              <p><span style="color: red; font-weight: bold;">Below 50 üí° Needs Focused Engagement</span></p>
            </div>
          </div>

          <!-- ‚úÖ Only latest submission table -->
          <div class="result-entry mb-4 p-3 border rounded shadow-sm mt-4">
            <h5>Submission on: <t t-esc="results[0].submitted_on.strftime('%Y-%m-%d %H:%M') if results[0].submitted_on else ''"/></h5>
            <p><strong>Total Score:</strong> <t t-esc="results[0].total_score"/>/180</p>
            <p><strong>Level:</strong> <t t-esc="results[0].level"/></p>

            <table class="table table-bordered table-striped mt-3">
              <thead>
                <tr>
                  <th>Question/Group</th>
                  <th>Score</th>
                  <th>Percentage</th>
                </tr>
              </thead>
              <tbody>
                <tr><td>Global Awareness</td><td><t t-esc="results[0].global_awareness"/></td><td><t t-esc="results[0].global_awareness_pct"/>%</td></tr>
                <tr><td>Civic Participation</td><td><t t-esc="results[0].civic_participation"/></td><td><t t-esc="results[0].civic_participation_pct"/>%</td></tr>
                <tr><td>Environmental Awareness</td><td><t t-esc="results[0].environment"/></td><td><t t-esc="results[0].environment_pct"/>%</td></tr>
                <tr><td>Ethical Understanding</td><td><t t-esc="results[0].ethical"/></td><td><t t-esc="results[0].ethical_pct"/>%</td></tr>
                <tr><td>Peace &amp; Conflict Resolution</td><td><t t-esc="results[0].peace"/></td><td><t t-esc="results[0].peace_pct"/>%</td></tr>
                <tr><td>Intercultural Understanding</td><td><t t-esc="results[0].intercultural"/></td><td><t t-esc="results[0].intercultural_pct"/>%</td></tr>
              </tbody>
            </table>
          </div>

        <div class="mt-4 text-center">
          <a t-att-href="'/GDfH_Scoring_Test/previous_results?email=' + results[0].email"
              class="btn btn-primary"> View Previous Results
          </a>
</div>

        </t>

        <div class="mt-4">
          <a href="/" class="btn btn-secondary">Home</a>
          <a href="/GDfH_Scoring_Test" class="btn btn-primary">Go Back</a>
        </div>
      </div>

      <!-- Chart.js -->
      <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
      <script>
        document.addEventListener("DOMContentLoaded", function () {
          const ctx = document.getElementById("gdfhChart").getContext("2d");

          const scores = [
            <t t-esc="results[0].global_awareness" />,
            <t t-esc="results[0].civic_participation" />,
            <t t-esc="results[0].environment" />,
            <t t-esc="results[0].ethical" />,
            <t t-esc="results[0].peace" />,
            <t t-esc="results[0].intercultural" />
          ];

          const percentages = [
            <t t-esc="results[0].global_awareness_pct" />,
            <t t-esc="results[0].civic_participation_pct" />,
            <t t-esc="results[0].environment_pct" />,
            <t t-esc="results[0].ethical_pct" />,
            <t t-esc="results[0].peace_pct" />,
            <t t-esc="results[0].intercultural_pct" />
          ];

          const colors = scores.map(score => {
            if (score >= 25.5) return 'green';
            else if (score >= 21) return '#28a745';
            else if (score >= 15) return 'orange';
            else return 'red';
          });

          new Chart(ctx, {
            type: "bar",
            data: {
              labels: [
                "Global Awareness",
                "Civic Participation",
                "Environmental Awareness",
                "Ethical Understanding",
                "Peace &amp; Conflict Resolution",
                "Intercultural Understanding"
              ],
              datasets: [
                {
                  label: "Score",
                  data: scores,
                  backgroundColor: colors,
                  borderColor: "rgba(0,0,0,0.2)",
                  borderWidth: 1
                },
                {
                  label: "Percentage",
                  data: percentages,
                  type: "line",
                  borderColor: "blue",
                  borderWidth: 2,
                  fill: false,
                  yAxisID: 'y1'
                }
              ]
            },
            options: {
              responsive: true,
              interaction: { mode: 'index', intersect: false },
              scales: {
                y: {
                  beginAtZero: true,
                  title: { display: true, text: 'Score' },
                  suggestedMax: 30
                },
                y1: {
                  beginAtZero: true,
                  position: 'right',
                  title: { display: true, text: 'Percentage (%)' },
                  suggestedMax: 100,
                  grid: { drawOnChartArea: false }
                }
              }
            }
          });
        });
      </script>
    </t>
  </template>
<template id="view_result_template" name="GDfH Scoring Result">
    <t t-call="website.layout">
      <div class="container mt-5">
        <t t-if="results">
          <h2 class="mb-4">Thank you, <t t-esc="results[0].name"/>!</h2>
          <p><strong>Email:</strong> <t t-esc="results[0].email"/></p>
          <p><strong>Country:</strong> <t t-esc="results[0].country"/></p>

          <!-- ‚úÖ PAGE 1: Graph + Legend -->
          <div class="row mt-4">
            <div class="col-md-8">
              <h3 class="mb-3">Score Graph</h3>
              <canvas id="gdfhChart"></canvas>
            </div>
            <div class="col-md-3">
              <h3 class="mb-3">Legend</h3>
              <p><span style="color: green; font-weight: bold;">85-100 üåü Progressive Visionary</span></p>
              <p><span style="color: #28a745; font-weight: bold;">70-84 ‚úÖ Strong Contributor</span></p>
              <p><span style="color: orange; font-weight: bold;">50-69 ‚ö†Ô∏è Emerging Contributor</span></p>
              <p><span style="color: red; font-weight: bold;">Below 50 üí° Needs Focused Engagement</span></p>
            </div>
          </div>

          <!-- ‚úÖ Only latest submission table -->
          <div class="result-entry mb-4 p-3 border rounded shadow-sm mt-4">
            <h5>Submission on: <t t-esc="results[0].submitted_on.strftime('%Y-%m-%d %H:%M') if results[0].submitted_on else ''"/></h5>
            <p><strong>Total Score:</strong> <t t-esc="results[0].total_score"/>/180</p>
            <p><strong>Level:</strong> <t t-esc="results[0].level"/></p>

            <table class="table table-bordered table-striped mt-3">
              <thead>
                <tr>
                  <th>Question/Group</th>
                  <th>Score</th>
                  <th>Percentage</th>
                </tr>
              </thead>
              <tbody>
                <tr><td>Global Awareness</td><td><t t-esc="results[0].global_awareness"/></td><td><t t-esc="results[0].global_awareness_pct"/>%</td></tr>
                <tr><td>Civic Participation</td><td><t t-esc="results[0].civic_participation"/></td><td><t t-esc="results[0].civic_participation_pct"/>%</td></tr>
                <tr><td>Environmental Awareness</td><td><t t-esc="results[0].environment"/></td><td><t t-esc="results[0].environment_pct"/>%</td></tr>
                <tr><td>Ethical Understanding</td><td><t t-esc="results[0].ethical"/></td><td><t t-esc="results[0].ethical_pct"/>%</td></tr>
                <tr><td>Peace &amp; Conflict Resolution</td><td><t t-esc="results[0].peace"/></td><td><t t-esc="results[0].peace_pct"/>%</td></tr>
                <tr><td>Intercultural Understanding</td><td><t t-esc="results[0].intercultural"/></td><td><t t-esc="results[0].intercultural_pct"/>%</td></tr>
              </tbody>
            </table>
          </div>

       

        </t>

        <div class="mt-4">
          <a href="https://bostongithub08-c4h.odoo.com/" class="btn btn-secondary">Home</a>
          <a href="/GDfH_Scoring_Test" class="btn btn-primary">Go Back</a>
        </div>
      </div>

      <!-- Chart.js -->
      <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
      <script>
        document.addEventListener("DOMContentLoaded", function () {
          const ctx = document.getElementById("gdfhChart").getContext("2d");

          const scores = [
            <t t-esc="results[0].global_awareness" />,
            <t t-esc="results[0].civic_participation" />,
            <t t-esc="results[0].environment" />,
            <t t-esc="results[0].ethical" />,
            <t t-esc="results[0].peace" />,
            <t t-esc="results[0].intercultural" />
          ];

          const percentages = [
            <t t-esc="results[0].global_awareness_pct" />,
            <t t-esc="results[0].civic_participation_pct" />,
            <t t-esc="results[0].environment_pct" />,
            <t t-esc="results[0].ethical_pct" />,
            <t t-esc="results[0].peace_pct" />,
            <t t-esc="results[0].intercultural_pct" />
          ];

          const colors = scores.map(score => {
            if (score >= 25.5) return 'green';
            else if (score >= 21) return '#28a745';
            else if (score >= 15) return 'orange';
            else return 'red';
          });

          new Chart(ctx, {
            type: "bar",
            data: {
              labels: [
                "Global Awareness",
                "Civic Participation",
                "Environmental Awareness",
                "Ethical Understanding",
                "Peace &amp; Conflict Resolution",
                "Intercultural Understanding"
              ],
              datasets: [
                {
                  label: "Score",
                  data: scores,
                  backgroundColor: colors,
                  borderColor: "rgba(0,0,0,0.2)",
                  borderWidth: 1
                },
                {
                  label: "Percentage",
                  data: percentages,
                  type: "line",
                  borderColor: "blue",
                  borderWidth: 2,
                  fill: false,
                  yAxisID: 'y1'
                }
              ]
            },
            options: {
              responsive: true,
              interaction: { mode: 'index', intersect: false },
              scales: {
                y: {
                  beginAtZero: true,
                  title: { display: true, text: 'Score' },
                  suggestedMax: 30
                },
                y1: {
                  beginAtZero: true,
                  position: 'right',
                  title: { display: true, text: 'Percentage (%)' },
                  suggestedMax: 100,
                  grid: { drawOnChartArea: false }
                }
              }
            }
          });
        });
      </script>
    </t>
  </template>

  <template id="no_result_template" name="No Result Found">
    <t t-call="website.layout">
        <div class="container mt-5">
            <h2>No result found!</h2>
            <a href="/GDfH_Scoring_Test" class="btn btn-primary">Back to Form</a>
        </div>
    </t>
</template>
</odoo>