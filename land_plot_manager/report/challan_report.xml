<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <data>

        <!-- ==================== Paperformat for Challan ==================== -->
        <record id="paperformat_no_challan" model="report.paperformat">
            <field name="name">Challan Report Format</field>
            <field name="default" eval="False"/>
            <field name="format">A4</field>
            <field name="orientation">Landscape</field>
            <field name="margin_top">15</field>
            <field name="margin_bottom">15</field>
            <field name="margin_left">8</field>
            <field name="margin_right">8</field>
            <field name="header_line" eval="False"/>
            <field name="dpi">90</field>
        </record>

        <!-- ==================== Challan Report Action ==================== -->
        <record id="challan_report_action" model="ir.actions.report">
            <field name="name">Challan Report</field>
            <field name="model">account.move</field>
            <field name="report_type">qweb-pdf</field>
            <field name="report_name">land_plot_manager.challan_report_template</field>
            <field name="report_file">land_plot_manager.challan_report_template</field>
            <field name="binding_model_id" ref="account.model_account_move"/>
            <field name="binding_type">report</field>
            <field name="print_report_name">
                'Challan-' + (object.name or str(object.id) or 'Draft')
            </field>
            <field name="paperformat_id" ref="land_plot_manager.paperformat_no_challan"/>
        </record>

        <!-- ==================== Challan Report Template ==================== -->
        <template id="challan_report_template">
            <t t-name="land_plot_manager.challan_report_template">
                <t t-call="web.html_container">
                    <t t-call="web.basic_layout">

                        <style>
                            .challan-row {
                            width: 100%;
                            margin: 0 0 10px 0;
                            text-align: left;
                            page-break-after: always;
                            }
                            .challan-box {
                            display: inline-block;
                            vertical-align: top;
                            width: 32%;
                            border: 1px solid #000;
                            padding: 10px;
                            font-size: 12px;
                            box-sizing: border-box;
                            page-break-inside: avoid;
                            }

                            table {
                            width: 100%;
                            border-collapse: collapse;
                            }
                            table th, table td {
                            border: 1px solid #000;
                            padding: 6px 12px;
                            font-size: 11px;
                            }

                            .info-table th, .info-table td {
                            border: 1px solid #000;
                            padding: 6px 12px;
                            }

                            .td-label {
                            width: 25%;
                            padding-left: 12px;
                            font-weight: bold;
                            }
                            .td-value {
                            padding-left: 12px;
                            }

                            .head-line {
                            margin: 0;
                            font-size: 12px;
                            }
                        </style>

                        <main>
                            <t t-foreach="docs" t-as="doc">

                                <div class="challan-row">
                                    <t t-set="copies" t-value="['Bank Copy','Office Copy','Customer Copy']"/>

                                    <t t-foreach="copies" t-as="copy">
                                        <div class="challan-box">

                                            <!-- TOP TITLE -->
                                            <p class="head-line">
                                                <b>Challan #:</b>
                                                <t t-esc="doc.name"/>
                                            </p>

                                            <!-- LOGOS -->
                                            <table style="margin-top:4px; border-collapse:none; border:0px solid #fff; width:100%;">
                                                <tr>
                                                    <td style="width:50%; text-align:left; border:0; padding:0;">
                                                        <img t-att-src="'/land_plot_manager/static/src/img/bank.png'"
                                                             style="width:120px;"/>
                                                    </td>
                                                    <td style="width:50%; text-align:right; border:0; padding:0;">
                                                        <img t-att-src="'/land_plot_manager/static/src/img/logo.png'"
                                                             style="width:60px;"/>
                                                    </td>
                                                </tr>
                                            </table>

                                            <!-- DATE LINES -->
                                            <p class="head-line" style="margin-top:4px;">
                                                <b>Date of Issue:</b>
                                                <t t-esc="doc.invoice_date"/>
                                            </p>
                                            <p class="head-line">
                                                <b>Expiry Date:</b>
                                                <t t-esc="doc.invoice_date_due.strftime('%d-%m-%Y') if doc.invoice_date_due else ''"/>
                                            </p>

                                            <p style="margin-top:4px; font-size:11px;">
                                                <b>Payable at any Faysal Bank branch (cash only)</b>
                                            </p>

                                            <div style="border:1px solid #000; padding:6px 12px; text-align:center; font-size:11px; margin-top:4px;">
                                                Faysal Transact
                                                <br/>
                                                https://fbltransactcollection.faysalbank.com
                                                <br/>
                                                Accepted At All FBL Branches
                                            </div>

                                            <!-- CUSTOMER INFO -->
                                            <table class="info-table" style="margin-top:8px;">
                                                <tr>
                                                    <td class="td-label">Name:</td>
                                                    <td class="td-value">
                                                        <t t-esc="doc.partner_id.name"/>
                                                    </td>
                                                    <td class="td-label">Member #:</td>
                                                    <td class="td-value">
                                                        <t t-esc="doc.partner_id.member_id or ''"/>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td class="td-label">Category:</td>
                                                    <td class="td-value">
                                                        <t t-esc="doc.invoice_line_ids[0].product_id.categ_id.name if doc.invoice_line_ids else ''"/>
                                                    </td>
                                                    <td class="td-label">Size:</td>
                                                    <td class="td-value">
                                                        <t t-set="line"
                                                           t-value="doc.invoice_line_ids and doc.invoice_line_ids[0]"/>
                                                        <t t-if="line and line.product_id">
                                                            <t t-esc="line.product_id.size_marla"/>
                                                        </t>
                                                        <t t-else="">-</t>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td class="td-label">Installment No:</td>
                                                    <td class="td-value" colspan="3">
                                                        <t t-esc="doc.invoice_line_ids[0].name if doc.invoice_line_ids else ''"/>
                                                    </td>
                                                </tr>
                                            </table>

                                            <!-- AMOUNTS -->
                                            <table style="margin-top:8px;">
                                                <tr>
                                                    <th>Particulars</th>
                                                    <th style="width:35%;">Amount</th>
                                                </tr>
                                                <tr>
                                                    <td>
                                                        <span t-esc="doc.get_payment_type_name()"/>
                                                    </td>
                                                    <td>
                                                        <t t-esc="doc.amount_total"/>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td>
                                                        <b>Total</b>
                                                    </td>
                                                    <td>
                                                        <b>
                                                            <t t-esc="doc.amount_total"/>
                                                        </b>
                                                    </td>
                                                </tr>
                                            </table>

                                            <p style="margin-top:8px; font-size:11px;">
                                                <b>Total Amount in Words:</b>
                                                <t t-esc="doc.amount_total_in_words or ''"/>
                                            </p>

                                            <!-- SIGNATURES: 3 COLUMNS, HAR COPY MEIN SAME STRUCTURE -->
                                            <!-- SIGNATURES: SAME ON ALL COPIES -->
                                            <table style="width:100%; margin-top:20px; border-collapse:none; border:0px solid #fff;">
                                                <tr>
                                                    <!-- 1st column: Depositor -->
                                                    <td style="width:50%; text-align:center; border:0;">
                                                        _______________________
                                                        <br/>
                                                        Depositor's Signature
                                                    </td>

                                                    <!-- 2nd column: Bank Officer -->
                                                    <td style="width:50%; text-align:center; border:0;">
                                                        _______________________
                                                        <br/>
                                                        Bank Officer
                                                    </td>
                                                </tr>
                                            </table>


                                        </div>
                                    </t>
                                </div>

                            </t>
                        </main>

                    </t>
                </t>
            </t>

        </template>

    </data>
</odoo>
